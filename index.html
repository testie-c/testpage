<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tweets recap</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; padding: 0.5rem; line-height: 1.3; background-color: #f7f7f7; color: #666; font-size: 0.9rem; }
.container { max-width: 600px; margin: 0rem auto 0rem 0.5rem; padding: 0.5rem; border-radius: 4px; background-color: #f7f7f7; }
@media (max-width: 767px) { .container { max-width: 100%; padding: 0.5rem; margin: 0; } }
h1 { font-size: 1.1rem; color: #666; display: inline; }
h2 { font-size: 0.9rem; color: #666; display: inline; }
.input-group { margin: 0.5rem 0; display: flex; gap: 0.3rem; flex-wrap: nowrap; align-items: center; }
input[type="text"], input[type="date"], textarea { padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; color: #666; flex-shrink: 1; min-width: 0; }
input[type="text"] { flex-grow: 1; }
.container button { margin: 0; border: none; font-size: 0.8rem; padding: 0.5rem 0.8rem; border-radius: 999px; font-weight: bold; cursor: pointer; background-color: #ffb366; color: #fff; transition: background-color 0.3s ease, color 0.3s ease; flex-shrink: 1; min-width: 0; }
.container button:hover { background-color: #ffa347; }
#summary-section { border-top: 1px solid #ddd; display: flex; align-items: center; gap: 0.5rem; }
#summary-section button{font-size:0.7rem;padding:0.3rem 0.7rem;}
.summary-header { display: flex; flex-direction: column; justify-content: center; gap: 0.25rem; margin: 0.5rem 0rem; }
#summarized-posts { flex-grow: 1; min-height: 3rem; font-size: 0.8rem; resize: vertical; }
#results { border-top: 1px solid #ddd; }
.post-line { font-size: 0.9rem; padding: 0.5rem 0; border-bottom: 1px dashed #ddd; word-wrap: break-word; overflow-wrap: break-word; }
.post-time { color: #66b3ff; text-decoration: none; }
.post-time:hover { text-decoration: underline; color: #4da6ff; }
#status { margin-top: 0.5rem; font-weight: bold; color: #ff99cc; }
</style>
</head>
<body>
<div id="header-placeholder"></div>
<div class="container">
<div class="header-content" style="display:flex; flex-wrap:wrap; align-items:center; gap:1rem;"><h1>tweets recap</h1><p>ãã®æ—¥ã®kind:1ã‚’è¡¨ç¤ºã—ã¾ã™</p></div>
<div class="input-group">
<label for="npub" style="display:none;">pubkey</label><input type="text" id="npub" placeholder="npub1... or NIP-05" style="flex-grow: 1;">
<label for="date" style="display:none;">date</label><input type="date" id="date"><button onclick="searchPosts()">recap</button><button onclick="createShareLink()">share</button> </div>
<div id="summary-section">
 <div class="summary-header">
 <h2 style="display:none;">ã¾ã¨ã‚</h2>
 <button onclick="summarizePosts()">ã¾ã¨ã‚ã‚‹</button>
 <button onclick="copySummarizedPosts()">ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>
 </div>
 <textarea id="summarized-posts" readonly placeholder="ã¡ã‚ƒã´ã«æŠ•ã’ã‚‹ç”¨"></textarea>
</div>
<div id="results">
<div id="post-list"></div>
<p id="status"></p>
</div>
</div>
<script src="https://unpkg.com/nostr-tools@1.17.0/lib/nostr.bundle.js"></script>
<script>
// NostrToolsã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦æä¾›ã•ã‚Œã‚‹ (ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.17.0ã®æŒ™å‹•)
const RELAY_URL = 'wss://relay.nostr.band';
let fetchedPosts = []; // æ¤œç´¢çµæœã®æŠ•ç¨¿ã‚’ä¿æŒã™ã‚‹é…åˆ—
const reactionCache = new Map(); // åå¿œã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹Map
const postElements = new Map(); // æŠ•ç¨¿ã®DOMè¦ç´ ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹Map
const reactionUpdateInterval = 5000; // ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å·®åˆ†æ›´æ–°ã‚’5ç§’ã”ã¨ã«è¡Œã†
/**
* NIP-05ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è§£æ±ºã—ã¦å…¬é–‹éµã‚’å–å¾—ã—ã¾ã™ã€‚
* @param {string} nip05 - NIP-05ã‚¢ãƒ‰ãƒ¬ã‚¹ (ä¾‹: user@example.com)
* @returns {Promise<string|null>} å…¬é–‹éµã®HEXæ–‡å­—åˆ—ã€ã¾ãŸã¯è§£æ±ºã§ããªã‹ã£ãŸå ´åˆã¯null
*/
async function resolveNip05(nip05) {
const parts = nip05.split('@');
if (parts.length !== 2) return null;
const [name, domain] = parts;
try {
const response = await fetch(`https://${domain}/.well-known/nostr.json?name=${name}`);
const data = await response.json();
return data.names[name] || null;
} catch (e) {
console.error(`NIP-05ã‚¢ãƒ‰ãƒ¬ã‚¹ã®è§£æ±ºã«å¤±æ•—ã—ã¾ã—ãŸ: ${nip05}`, e);
return null;
}
}
/**
* npubã€HEXã€ã¾ãŸã¯NIP-05ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¬é–‹éµã®HEXæ–‡å­—åˆ—ã«æ­£è¦åŒ–ã—ã¾ã™ã€‚
* @param {string} input - npubã€HEXã€ã¾ãŸã¯NIP-05ã‚¢ãƒ‰ãƒ¬ã‚¹
* @returns {Promise<string|null>} å…¬é–‹éµã®HEXæ–‡å­—åˆ—ã€ã¾ãŸã¯è§£æ±ºã§ããªã‹ã£ãŸå ´åˆã¯null
*/
async function normalizePubkey(input) {
if (input.startsWith("npub1")) {
try {
// NostrTools.nip19 ã‚’ä½¿ç”¨ (ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.17.0ã®æŒ™å‹•)
const { type, data } = NostrTools.nip19.decode(input);
if (type === 'npub') {
return data;
}
} catch (e) {
console.error("npubã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ:", e);
return null;
}
} else if (/^[a-f0-9]{64}$/i.test(input)) {
return input;
} else if (input.includes('@')) {
return await resolveNip05(input);
}
return null;
}
/**
* æŠ•ç¨¿ã¨ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚
* æŠ•ç¨¿ã¯åˆå›æç”»ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯å·®åˆ†æ›´æ–°ã‚’è¡Œã„ã¾ã™ã€‚
* @param {Array<Object>} posts - æŠ•ç¨¿ã‚¤ãƒ™ãƒ³ãƒˆã®é…åˆ—
* @param {Array<Object>} reactions - ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®é…åˆ—
* @param {boolean} isInitialDraw - åˆå›æç”»ã‹ã©ã†ã‹
*/
const renderPostsAndReactions = (posts, reactions, isInitialDraw) => {
const postList = document.getElementById("post-list");
const statusMessage = document.getElementById("status");
// ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’é›†è¨ˆ
const reactionCounts = {};
reactions.forEach(reaction => {
const targetEventId = reaction.tags.find(tag => tag[0] === 'e')?.[1];
if (targetEventId) {
if (!reactionCounts[targetEventId]) {
reactionCounts[targetEventId] = { reposts: 0, reactions: 0 };
}
if (reaction.kind === 6) {
reactionCounts[targetEventId].reposts++;
} else if (reaction.kind === 7) {
reactionCounts[targetEventId].reactions++;
}
}
});
if (isInitialDraw) {
fetchedPosts = posts; // æ¤œç´¢çµæœã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
postList.innerHTML = '';
postElements.clear(); // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
if (posts.length === 0) {
statusMessage.textContent = 'æŒ‡å®šã•ã‚ŒãŸæ—¥ä»˜ã®æŠ•ç¨¿ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚';
return;
}
// æŠ•ç¨¿æ—¥æ™‚ãŒå¤ã„é †ï¼ˆæ˜‡é †ï¼‰ã«ã‚½ãƒ¼ãƒˆ
posts.sort((a, b) => a.created_at - b.created_at);
console.log(`[Rendering] æŠ•ç¨¿ ${posts.length} ä»¶ã‚’åˆå›æç”»ã—ã¾ã™ã€‚`);
posts.forEach(post => {
const postElement = document.createElement('div');
postElement.className = 'post';
postElement.dataset.eventId = post.id;
// æ—¥æ™‚ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const postDate = new Date(post.created_at * 1000);
const formattedDate = `${(postDate.getMonth() + 1).toString().padStart(2, '0')}/${postDate.getDate().toString().padStart(2, '0')} ${postDate.getHours().toString().padStart(2, '0')}:${postDate.getMinutes().toString().padStart(2, '0')}`;
// neventãƒªãƒ³ã‚¯ã‚’ä½œæˆ
const eventPointer = {
id: post.id,
relays: [RELAY_URL], // æ¤œç´¢ã«ä½¿ç”¨ã—ãŸãƒªãƒ¬ãƒ¼ã‚’å«ã‚ã‚‹
author: post.pubkey, // è‘—è€…ã®å…¬é–‹éµã‚’å«ã‚ã‚‹
};
// NostrTools.nip19 ã‚’ä½¿ç”¨ (ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.17.0ã®æŒ™å‹•)
const nevent = NostrTools.nip19.neventEncode(eventPointer);
const njumpLink = `https://njump.me/${nevent}`;
postElement.innerHTML = `
<div class="post-line">
<a href="${njumpLink}" target="_blank" class="post-time">[${formattedDate}]</a>
${linkifyAndEscapeHtml(post.content)}
<span class="reaction-counts"></span>
</div>
`;
postList.appendChild(postElement);
postElements.set(post.id, postElement);
});
}
// ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å·®åˆ†æ›´æ–°
posts.forEach(post => {
const counts = reactionCounts[post.id] || { reposts: 0, reactions: 0 };
const postElement = postElements.get(post.id);
if (postElement) {
const reactionSpan = postElement.querySelector('.reaction-counts');
if (reactionSpan) {
reactionSpan.innerHTML = counts.reposts > 0 || counts.reactions > 0 ? ` [â­${counts.reactions} ğŸ”${counts.reposts}] ` : '';
}
}
});
statusMessage.textContent = `ã“ã®æ—¥ã®æŠ•ç¨¿æ•°ï¼š${posts.length}ãƒ„ã‚¤ãƒ¼ãƒˆ`;
};
// æŠ•ç¨¿ã‚’æ¤œç´¢ã—ã€è¡¨ç¤ºã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
const searchPosts = async () => {
const npubInput = document.getElementById("npub").value.trim();
const dateStr = document.getElementById("date").value;
const statusMessage = document.getElementById("status");
const summarizedPostsArea = document.getElementById("summarized-posts");
// æ¤œç´¢é–‹å§‹æ™‚ã®åˆæœŸåŒ–
document.getElementById("post-list").innerHTML = '';
statusMessage.textContent = 'æ¤œç´¢ä¸­...';
summarizedPostsArea.value = '';
fetchedPosts = [];
reactionCache.clear();
postElements.clear();
if (!npubInput || !dateStr) {
statusMessage.textContent = 'npubã¾ãŸã¯NIP-05ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨æ—¥ä»˜ã®ä¸¡æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
return;
}
let pubkey;
try {
// npubInputã‚’å…¬é–‹éµï¼ˆHEXï¼‰ã«æ­£è¦åŒ–
pubkey = await normalizePubkey(npubInput);
if (!pubkey) {
throw new Error('ç„¡åŠ¹ãªnpubã€NIP-05ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã¾ãŸã¯å…¬é–‹éµå½¢å¼ã§ã™ã€‚');
}
} catch (e) {
statusMessage.textContent = e.message;
return;
}
// æŒ‡å®šæ—¥ã®00:00:00ã¨23:59:59ã®UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨ˆç®—
const date = new Date(dateStr);
if (isNaN(date.getTime())) {
statusMessage.textContent = 'ç„¡åŠ¹ãªæ—¥ä»˜å½¢å¼ã§ã™ã€‚';
return;
}
const sinceTime = Math.floor(date.setHours(0, 0, 0, 0) / 1000);
const untilTime = Math.floor(date.setHours(23, 59, 59, 999) / 1000);
// Kind:1ã¨Kind:42ã®æŠ•ç¨¿ã‚’æœ€åˆã«å–å¾—ã—ã¦æç”»
console.log(`[Step 1] ãƒ¡ã‚¤ãƒ³ãƒªãƒ¬ãƒ¼ã‹ã‚‰ kind:1, 42 ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œç´¢ã—ã¾ã™...`);
try {
const kinds1And42Events = await fetchPosts(RELAY_URL, pubkey, sinceTime, untilTime);
const eventIds = kinds1And42Events.map(e => e.id);
renderPostsAndReactions(kinds1And42Events, [], true); // åˆå›æç”»
if (eventIds.length > 0) {
// Kind:10002ã¨Kind:6,7ã‚’è£ã§å–å¾—é–‹å§‹
fetchReactionsInBackground(pubkey, eventIds, sinceTime, untilTime);
}
} catch (e) {
statusMessage.textContent = `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}`;
console.error('[Fatal Error]', e);
}
};
/**
* Kind:1, 42ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
* @param {string} relayUrl - æ¥ç¶šã™ã‚‹ãƒªãƒ¬ãƒ¼ã®URL
* @param {string} pubkey - æ¤œç´¢ã™ã‚‹å…¬é–‹éµ
* @param {number} sinceTime - æ¤œç´¢é–‹å§‹UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
* @param {number} untilTime - æ¤œç´¢çµ‚äº†UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
* @returns {Promise<Array<Object>>} å–å¾—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®é…åˆ—
*/
const fetchPosts = async (relayUrl, pubkey, sinceTime, untilTime) => {
const events = [];
try {
const relay = NostrTools.relayInit(relayUrl);
await relay.connect();
const sub = relay.sub([
{
kinds: [1, 42],
authors: [pubkey],
since: sinceTime,
until: untilTime,
}
]);
return new Promise((resolve, reject) => {
sub.on('event', (event) => {
events.push(event);
});
sub.on('eose', () => {
relay.close();
console.log(`[FetchPosts] æŠ•ç¨¿ã®æ¤œç´¢ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æŠ•ç¨¿æ•°: ${events.length}ä»¶ã€‚`);
resolve(events);
});
setTimeout(() => {
relay.close();
resolve(events); // EOSEãŒæ¥ãªã„å ´åˆã§ã‚‚ä¸€å®šæ™‚é–“ã§çµ‚äº†
}, 5000);
});
} catch (e) {
console.error(`[FetchPosts] ãƒªãƒ¬ãƒ¼ ${relayUrl} ã¸ã®æ¥ç¶šã¾ãŸã¯è³¼èª­ã«å¤±æ•—ã—ã¾ã—ãŸ:`, e);
return events;
}
};
/**
* Kind:10002ã¨Kind:6,7ã‚’è£ã§å–å¾—ã—ã€å·®åˆ†æ›´æ–°ã‚’è¡Œã†
* @param {string} pubkey - è‘—è€…ã®å…¬é–‹éµ
* @param {Array<string>} eventIds - ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¤œç´¢ã™ã‚‹æŠ•ç¨¿IDã®é…åˆ—
* @param {number} sinceTime - æ¤œç´¢é–‹å§‹UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
* @param {number} untilTime - æ¤œç´¢çµ‚äº†UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
*/
const fetchReactionsInBackground = async (pubkey, eventIds, sinceTime, untilTime) => {
let relayUrlsToSearch = new Set();
// Kind:10002 (ãƒªãƒ¬ãƒ¼ãƒªã‚¹ãƒˆ) ã‚’å–å¾—
console.log(`[Background] Kind:10002ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ãƒªãƒ¬ãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™...`);
try {
const mainRelay = NostrTools.relayInit(RELAY_URL);
await mainRelay.connect();
const sub10002 = mainRelay.sub([{ kinds: [10002], authors: [pubkey], limit: 1 }]);
const kind10002Event = await new Promise(resolve => {
sub10002.on('event', (event) => {
resolve(event);
});
sub10002.on('eose', () => {
resolve(null);
});
setTimeout(() => {
resolve(null);
}, 3000); // 3ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
});
mainRelay.close();
if (kind10002Event) {
kind10002Event.tags.forEach(tag => {
if (tag[0] === 'r' && tag[1].startsWith('wss://')) {
relayUrlsToSearch.add(tag[1]);
}
});
console.log(`[Background] Kind:10002ã‚¤ãƒ™ãƒ³ãƒˆã®è³¼èª­ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¤œç´¢å¯¾è±¡ãƒªãƒ¬ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:`, Array.from(relayUrlsToSearch));
} else {
console.log(`[Background] Kind:10002ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ¡ã‚¤ãƒ³ãƒªãƒ¬ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`);
}
} catch (e) {
console.error(`[Background] Kind:10002ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¡ã‚¤ãƒ³ãƒªãƒ¬ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™:`, e);
}
// Kind:10002ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã¯ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ¡ã‚¤ãƒ³ãƒªãƒ¬ãƒ¼ã‚’ä½¿ç”¨
if (relayUrlsToSearch.size === 0) {
relayUrlsToSearch.add(RELAY_URL);
}
// ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è³¼èª­ã—ã€å®šæœŸçš„ã«å·®åˆ†æ›´æ–°
const untilNow = Math.floor(Date.now() / 1000);
const reactionRelayPromises = Array.from(relayUrlsToSearch).map(relayUrl => {
return new Promise(async (resolve) => {
try {
const reactionRelay = NostrTools.relayInit(relayUrl);
await reactionRelay.connect();
const sub = reactionRelay.sub([
{
kinds: [6, 7],
'#e': eventIds,
since: sinceTime,
until: untilNow,
}
]);
sub.on('event', (event) => {
reactionCache.set(event.id, event);
});
sub.on('eose', () => {
reactionRelay.close();
resolve();
});
} catch (e) {
console.error(`[Background] ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å–å¾—ç”¨ãƒªãƒ¬ãƒ¼ ${relayUrl} ã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚`, e);
resolve();
}
});
});
await Promise.all(reactionRelayPromises);
// å–å¾—ã—ãŸãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å·®åˆ†æ›´æ–°
renderPostsAndReactions(fetchedPosts, Array.from(reactionCache.values()), false);
console.log(`[Background] ã™ã¹ã¦ã®ãƒªãƒ¬ãƒ¼ã‹ã‚‰ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®åˆæœŸå–å¾—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚`);
};
// HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°
const escapeHtml = (text) => {
const div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
};
// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¨­å®šã™ã‚‹
document.addEventListener('DOMContentLoaded', () => {
const dateInput = document.getElementById('date');
const today = new Date();
const year = today.getFullYear();
const month = String(today.getMonth() + 1).padStart(2, '0'); // æœˆã¯0ã‹ã‚‰å§‹ã¾ã‚‹ãŸã‚+1
const day = String(today.getDate()).padStart(2, '0');
dateInput.value = `${year}-${month}-${day}`;
});
// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰npubã¨dateã‚’å–å¾—ã—ã€æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹
document.addEventListener('DOMContentLoaded', () => {
const urlParams = new URLSearchParams(window.location.search);
const npubFromUrl = urlParams.get('npub');
const dateFromUrl = urlParams.get('date');
if (npubFromUrl && dateFromUrl) {
document.getElementById("npub").value = npubFromUrl;
document.getElementById("date").value = dateFromUrl;
searchPosts();
}
});
// ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ãƒœã‚¿ãƒ³ã¨é–¢æ•°ã‚’è¿½åŠ 
const createShareLink = () => {
const npub = document.getElementById("npub").value;
const date = document.getElementById("date").value;
if (!npub || !date) {
alert("å…ˆã«npubã¨æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
return;
}
const shareUrl = `${window.location.origin}${window.location.pathname}?npub=${encodeURIComponent(npub)}&date=${encodeURIComponent(date)}`;
// ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
navigator.clipboard.writeText(shareUrl).then(() => {
alert('ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
}).catch(err => {
console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
});
};
// æŠ•ç¨¿ã‚’ã¾ã¨ã‚ã‚‹é–¢æ•°ï¼ˆtextareaã«è¡¨ç¤ºã™ã‚‹ã ã‘ï¼‰
const summarizePosts = () => {
const summarizedPostsArea = document.getElementById("summarized-posts");
if (fetchedPosts.length === 0) {
alert("å…ˆã«ãƒ„ã‚¤ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚");
return;
}
const summary = fetchedPosts.map(post => {
const postDate = new Date(post.created_at * 1000);
const formattedDate = `${postDate.getFullYear()}/${(postDate.getMonth() + 1).toString().padStart(2, '0')}/${postDate.getDate().toString().padStart(2, '0')} ${postDate.getHours().toString().padStart(2, '0')}:${postDate.getMinutes().toString().padStart(2, '0')}:${postDate.getSeconds().toString().padStart(2, '0')}`;
return `[${formattedDate}]\n${post.content}`;
}).join('\n---\n');
summarizedPostsArea.value = summary;
};
// ã‚³ãƒ”ãƒ¼ã™ã‚‹é–¢æ•°ï¼ˆtextareaã®å†…å®¹ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ï¼‰
const copySummarizedPosts = () => {
const text = document.getElementById("summarized-posts").value;
if (!text.trim()) {
alert("å…ˆã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚");
return;
}
navigator.clipboard.writeText(text).then(() => {
alert('ã¾ã¨ã‚ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
}).catch(err => {
console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
});
};
/**
* ãƒ†ã‚­ã‚¹ãƒˆå†…ã®URLã‚’ãƒªãƒ³ã‚¯ã«å¤‰æ›ã—ã€HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚‚è¡Œã„ã¾ã™ã€‚
* @param {string} text - å‡¦ç†å¯¾è±¡ã®ãƒ†ã‚­ã‚¹ãƒˆ
* @returns {string} ãƒªãƒ³ã‚¯åŒ–ã•ã‚ŒãŸHTMLæ–‡å­—åˆ—
*/
const linkifyAndEscapeHtml = (text) => {
// ã¾ãšHTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
const escapedText = escapeHtml(text);
// httpã¾ãŸã¯httpsã§å§‹ã¾ã‚‹URLã‚’æ¤œå‡ºã™ã‚‹æ­£è¦è¡¨ç¾
const urlRegex = /(https?:\/\/[^\s]+)/g;
// URLã‚’<a>ã‚¿ã‚°ã«ç½®ãæ›ãˆã‚‹
return escapedText.replace(urlRegex, (url) => {
return `<a href="${url}" target="_blank">${url}</a>`;
});
};
</script>
<script src="https://ompomz.github.io/header/loadHeader.js"></script>
</body>
</html>
